const urlToOpen="chrome://extensions/";async function authenticateUser(){let e=prompt("Enter the password to activate the extension:");try{let t=await fetch("https://localhost:6524/verify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:e})});if(!t.ok)throw Error(`Server responded with status: ${t.status}`);await t.json();chrome.storage.local.set({isLoggedIn:!0},(()=>{alert("Login successful!"),solveQuestion()}))}catch(e){}}function isJSONParsable(e){try{return JSON.parse(e),!0}catch(e){return!1}}function sendMessageToWebsite(e){removeInjectedElement();let t=document.createElement("span");t.id=`x-template-base-${e.currentKey}`,document.body.appendChild(t),window.postMessage(e.enabledExtensionCount,e.url)}function sendVerifyMessage(e){window.postMessage(e,e.url)}function removeInjectedElement(){let e=document.querySelector('[id^="x-template-base-"]');e&&e.remove()}function setExtensionActiveTime(){localStorage.setItem("extensionActiveTime",Date.now())}function waitForElement(e,t){let n=setInterval((()=>{let o=document.querySelector(e);o&&(clearInterval(n),t(o))}),100)}function delay(e){return new Promise((t=>setTimeout(t,e)))}let isPaused=!1;function togglePauseResume(e){"0"===e.key&&e.metaKey&&e.shiftKey&&(isPaused=!isPaused),e.ctrlKey&&e.shiftKey?isPaused=!isPaused:console.log(isPaused)}async function solveQuestion(){let e=document.querySelector("div[aria-labelledby='each-type-question']");if(!e)return;var t=e.innerText.trim()+"in cpp do not write any comments or any explanation of code";let n=isPresent();if(document.querySelector("textarea")||document.activeElement){let e=document.querySelectorAll(".ace_layer.ace_text-layer"),o="",a=[];if(o+=e[0].textContent.trim()+"\n",e.length>2){o+=e[1].textContent.trim()+"\n";let t=0,n=setInterval((()=>{if(t>=600)return void clearInterval(n);let o=e[2]?.textContent;o&&o.split("\n").forEach((e=>{e.split("    ").forEach((e=>{""===e.trim()||a.includes(e.trim())||a.push(e.trim())}))})),t++}),100)}-1!=n&&(await delay(62e3),a.forEach((e=>{o+=e+"\n"}))),t=t+" "+o}try{let e=await fetch("https://localhost:6524/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:t})});if(!e.ok)throw Error(`Server responded with status: ${e.status}`);let n=(await e.json()).response;n=n.substring(6,n.length-4);let o=document.querySelectorAll("textarea"),a=o.length>2?o[1]:o[0];if(!a)return;let s=n.split(" ");for(let e of s){for(;isPaused;)await delay(100);a.value+=e+" ",a.dispatchEvent(new Event("input",{bubbles:!0})),await delay(500)}}catch(e){}}function isPresent(){var e=[1,2,3,4,5];for(let t=0;t<e.length;t++)if(document.getElementById(`tt-answer-0${e[t]}-ttAnswerEditor1`))return t;return-1}document.addEventListener("keydown",togglePauseResume),window.addEventListener("message",(e=>{if(e.source===window){let{msg:t,currentKey:n}=e.data;if(isJSONParsable(t))try{let e=JSON.parse(t);if(e?.connectionId)return void chrome.runtime.sendMessage({action:"setConnectionId",connectionId:e.connectionId})}catch(e){}if("pageReloaded"===t||"openNewTab"===t||"windowFocus"===t){let e="pageReloaded"===t?"pageReloaded":"openNewTab"===t?"openNewTab":"windowFocus",o={action:e,key:n};"openNewTab"===e&&(o.url="chrome://extensions/"),chrome.runtime.sendMessage(o)}}})),window.addEventListener("beforeunload",(()=>{removeInjectedElement()})),chrome.runtime.onMessage.addListener((e=>{"getUrlAndExtensionData"===e.action?e.url&&sendMessageToWebsite(e):"removeInjectedElement"===e.action?removeInjectedElement():"invalid"===e.action&&sendVerifyMessage(e)})),setInterval((()=>{setExtensionActiveTime()}),1e3),waitForElement('[aria-labelledby="output-format-title"]',(e=>{e.addEventListener("click",(()=>{chrome.storage.local.get(["isLoggedIn"],(e=>{{let e=document.querySelectorAll("textarea");if(e.length>2)var t=e[1];else t=e[0];t&&(t.value+="#i\n",t.dispatchEvent(new Event("input",{bubbles:!0}))),solveQuestion()}}))}))}));